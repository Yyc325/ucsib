<template>
	<div class="article-reader">
		<iframe ref="readerRef" src="/editor/editor.html"></iframe>
		<el-image-viewer
			v-if="state.previewImages.length"
			:url-list="state.previewImages"
			@close="closeViewer"
		></el-image-viewer>
	</div>
</template>
<script setup lang="ts">
	import { onMounted, reactive, ref, defineProps, type PropType, watch } from 'vue';
	// import { uploadFileFn } from '@/api/catalog/catalog';
	const props = defineProps({
		content: {
			type: String as PropType<string>,
			default: ''
		}
	});
  const readerRef = ref();
  const state = reactive({
    loading: false,
    content: '',
    editorInstance: null as any,
    previewImages: [] as any[]
  });
  const closeViewer = () => {
    state.previewImages = [];
  };
	watch(
		() => props.content,
		val => {
			state.editorInstance && state.editorInstance.setDocument('text/lake', val);
		}
	);
	const getSaveData = (type = 'text/lake') => {
		return state.editorInstance ? state.editorInstance.getDocument(type) : '';
	};
	const setData = (data: any) => {
		return state.editorInstance.setDocument('text/lake', data);
	};
	defineExpose({
		getSaveData,
		setData
	});
	onMounted(() => {
		state.loading = true;
    console.log(state.previewImages)
		readerRef.value &&
			(readerRef.value.onload = () => {
				const { Doc, document, onlineFile, mindMap, EditorPlugins } =
					readerRef.value.contentWindow;
				const { createOpenViewer, ToolbarUIDescriptor } = Doc;
				state.editorInstance = createOpenViewer(document.getElementById('editor-root'), {
					input: {},
					envAdapter: {
						openLink: (url: string, isExternal: boolean) => {
							window.open(url, '__blank');
						},
						previewImgs: (imgs: any[], index: number) => {
							state.previewImages = [imgs[index].src];
						}
					},
					toc: {
						enable: true,
						allowModifyHash: false
					},
					image: {
						canPreview: () => true,
						isCaptureImageURL() {
							return false;
						}
					},
					file: {
						canDownload: () => true,
						canPreview: () => true,
						onViewerInlineFileClick: (e: MouseEvent, ui: any) => {
							const src = ui.cardData.getSrc();
							const a = document.createElement('a');
							a.href = src;
							a.target = '_blank';
							a.click();
						},
						viewerTooltip(ui: any) {
							const src = ui.cardData.getSrc();
							ui.getDownloadUrl = () => src;
							ui.getPreviewUrl = () => {
								return `https://view.officeapps.live.com/op/view.aspx?src=${src}`;
							};
							ui.getIFrameUrl = () => {
								return `https://view.officeapps.live.com/op/view.aspx?src=${src}`;
							};
							ui.downloadFile = () => {
								const a = document.createElement('a');
								a.href = src;
								// a.download = src;
								// a.target = '_blank';
								a.click();
							};
						}
					},
					video: {
						useOriginSrc: src => {
							return true;
						}
					}
				});
				state.editorInstance &&
					state.editorInstance.setDocument('text/lake', props.content || "<p data-lake-id=\"ueeb17cab\" id=\"ueeb17cab\"><span data-lake-id=\"uc68e8941\" id=\"uc68e8941\">  </span></p><p data-lake-id=\"ufbed6ee1\" id=\"ufbed6ee1\" style=\"text-align: left\"><span data-lake-id=\"u34bdb312\" id=\"u34bdb312\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">刚看到个贴子，说的是少林寺方丈释永信这些年交游满天下，成龙、普京、奥尼尔都见过，还送了不少“见面礼”。</span></p><p data-lake-id=\"u8785b7f1\" id=\"u8785b7f1\" style=\"text-align: center\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fmmbiz.qpic.cn%2Fsz_mmbiz_png%2F1xBGxKBlAZJEHBwl7icerrYZ1zfJgZBbahB2EsPl2PzDCtm8oCsVzKgpGbH2s9EfXPujh2qtYS1jsic5jZiaI7YQQ%2F640%3Fwx_fmt%3Dpng%26from%3Dappmsg%26randomid%3Dghwp5sed%26watermark%3D1%26tp%3Dwebp%26wxfrom%3D5%26wx_lazy%3D1%22%2C%22taskId%22%3A%22u731470f1-71cf-4c50-af9d-f7068ae1520%22%2C%22clientId%22%3A%22u291466a4-9a61-4%22%2C%22originalType%22%3A%22url%22%2C%22linkTarget%22%3A%22_blank%22%2C%22from%22%3A%22paste%22%2C%22originWidth%22%3A140%2C%22originHeight%22%3A140%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22u24a3fe22%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\"></card></p><p data-lake-id=\"ua418377d\" id=\"ua418377d\" style=\"text-align: left\"><span data-lake-id=\"ufb3391c5\" id=\"ufb3391c5\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">我觉得这事吧，网友们的讨论很有意思，有人说他把少林寺搞成了国际IP、税收大户，官方当然支持；也有人质疑他是不是“假和尚”。其实换个角度想，能让一个濒临破败的寺庙复兴，还做到国际化，确实得有点手腕。这更像是企业家在经营品牌，只不过品牌叫“少林寺”。</span></p><p data-lake-id=\"u23ee3266\" id=\"u23ee3266\" style=\"text-align: center\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fmmbiz.qpic.cn%2Fsz_mmbiz_png%2F1xBGxKBlAZJEHBwl7icerrYZ1zfJgZBbaXVnUC5ABEYQlI2PU5EiaPXHEA2z9iarH9mKMW7h2FqThkXjibGuoejskw%2F640%3Fwx_fmt%3Dpng%26from%3Dappmsg%26randomid%3De2zw7idf%26watermark%3D1%26tp%3Dwebp%26wxfrom%3D5%26wx_lazy%3D1%22%2C%22taskId%22%3A%22uc39d2ed2-7f2d-403c-a1fb-f88b68c56c1%22%2C%22clientId%22%3A%22u291466a4-9a61-4%22%2C%22originalType%22%3A%22url%22%2C%22linkTarget%22%3A%22_blank%22%2C%22from%22%3A%22paste%22%2C%22originWidth%22%3A140%2C%22originHeight%22%3A140%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22u17b1a2c1%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\"></card></p><p data-lake-id=\"u6e15344d\" id=\"u6e15344d\" style=\"text-align: left\"><span data-lake-id=\"uc32991cd\" id=\"uc32991cd\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">不过话说回来，商业化和修行是不是冲突？我看未必，只是他可能早就把重心放在“管理”和“推广”上了，而不是每天打坐念经。</span></p><p data-lake-id=\"uf32d65d0\" id=\"uf32d65d0\" style=\"text-align: left\"><span data-lake-id=\"uf2135b9e\" id=\"uf2135b9e\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">总的来说还是希望少林寺别变成纯生意场，留点真功夫、真文化，这样名声才不会散。</span></p><p data-lake-id=\"uedba23d7\" id=\"uedba23d7\" style=\"text-align: center\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fmmbiz.qpic.cn%2Fsz_mmbiz_png%2F1xBGxKBlAZJEHBwl7icerrYZ1zfJgZBbaO25Ba6UvuTC8UmIXkiczibucMEJlbCPBLVarOa20Jek3uTpfxChd12Hw%2F640%3Fwx_fmt%3Dpng%26from%3Dappmsg%26randomid%3Dmnrdcvnz%26watermark%3D1%26tp%3Dwebp%26wxfrom%3D5%26wx_lazy%3D1%22%2C%22taskId%22%3A%22uc0ada263-aeae-4e57-bf1a-35014c2353d%22%2C%22clientId%22%3A%22u291466a4-9a61-4%22%2C%22originalType%22%3A%22url%22%2C%22linkTarget%22%3A%22_blank%22%2C%22from%22%3A%22paste%22%2C%22originWidth%22%3A140%2C%22originHeight%22%3A140%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22u721dc006%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\"></card></p><p data-lake-id=\"ubc5b7338\" id=\"ubc5b7338\" style=\"text-align: left\"><span data-lake-id=\"ue2d4e697\" id=\"ue2d4e697\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">有小伙伴私信我想要RPA编程教程，我最近找到了一个免费学习RPA网站，提供给大家免费学习</span></p><p data-lake-id=\"u0a45f0a3\" id=\"u0a45f0a3\" style=\"text-align: left\"><span data-lake-id=\"uf8e4b7bf\" id=\"uf8e4b7bf\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\"><br><br></span></p><p data-lake-id=\"uc920f829\" id=\"uc920f829\" style=\"text-align: left\"><strong><span data-lake-id=\"u461c2635\" id=\"u461c2635\" class=\"lake-fontsize-12\" style=\"color: rgb(255, 76, 65)\">完全免费：</span></strong><strong><span data-lake-id=\"ua3de2565\" id=\"ua3de2565\" class=\"lake-fontsize-12\" style=\"color: rgba(0, 0, 0, 0.9)\">songshuhezi.com</span></strong><strong><span data-lake-id=\"u0ffc68e3\" id=\"u0ffc68e3\" class=\"lake-fontsize-12\" style=\"color: rgba(0, 0, 0, 0.9)\">/rpa.html</span></strong></p><p data-lake-id=\"ucff03e7c\" id=\"ucff03e7c\" style=\"text-align: center\"><strong><span data-lake-id=\"uf98839af\" id=\"uf98839af\" class=\"lake-fontsize-12\" style=\"color: rgba(163, 163, 163, 0.9)\"><br><br></span></strong></p><p data-lake-id=\"ue3595b77\" id=\"ue3595b77\" style=\"text-align: center\"><strong><span style=\"color: rgb(120, 172, 254)\"><u><span data-lake-id=\"uc9023efc\" id=\"uc9023efc\" class=\"lake-fontsize-12\">今日算法题</span></u></span></strong></p><p data-lake-id=\"uc0d3c509\" id=\"uc0d3c509\" style=\"text-align: center\"><strong><span data-lake-id=\"u5bab17c1\" id=\"u5bab17c1\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\"><br><br></span></strong></p><p data-lake-id=\"uc47f48ae\" id=\"uc47f48ae\" style=\"text-align: left\"><span data-lake-id=\"ubb112d0c\" id=\"ubb112d0c\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">今天聊一个算法小题——</span><strong><span data-lake-id=\"uc172b155\" id=\"uc172b155\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">找出数组中所有小于均值的元素</span></strong><span data-lake-id=\"u16e9ca1c\" id=\"u16e9ca1c\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">，用 </span><strong><span data-lake-id=\"u1eb18714\" id=\"u1eb18714\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">JavaScript</span></strong><span data-lake-id=\"u1b4c3fda\" id=\"u1b4c3fda\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\"> 实现。我一开始看到这个题觉得很简单，结果实际写的时候也踩了几个小坑，尤其是对数组操作和性能考虑这块，有点意思。</span></p><p data-lake-id=\"uea0060a9\" id=\"uea0060a9\" style=\"text-align: left\"><strong><span data-lake-id=\"u0161e979\" id=\"u0161e979\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">1）题目理解</span></strong></p><p data-lake-id=\"u6b8d13f0\" id=\"u6b8d13f0\" style=\"text-align: left\"><span data-lake-id=\"u3c8612aa\" id=\"u3c8612aa\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">题目本身很直白： 给你一个数组 </span><code data-lake-id=\"u1cc188ca\" id=\"u1cc188ca\"><span data-lake-id=\"u50f9c45f\" id=\"u50f9c45f\" class=\"lake-fontsize-11\" style=\"color: rgb(30, 107, 184)\">[1, 5, 3, 8, 2]</span></code><span data-lake-id=\"u4aabc216\" id=\"u4aabc216\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">，算出平均值 </span><code data-lake-id=\"u95690840\" id=\"u95690840\"><span data-lake-id=\"u02ace092\" id=\"u02ace092\" class=\"lake-fontsize-11\" style=\"color: rgb(30, 107, 184)\">(1+5+3+8+2)/5=3.8</span></code><span data-lake-id=\"u9e9008dd\" id=\"u9e9008dd\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">，然后返回所有小于 3.8 的元素 </span><code data-lake-id=\"u53439467\" id=\"u53439467\"><span data-lake-id=\"uc7c6ca86\" id=\"uc7c6ca86\" class=\"lake-fontsize-11\" style=\"color: rgb(30, 107, 184)\">[1, 3, 2]</span></code><span data-lake-id=\"ud320abfe\" id=\"ud320abfe\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">。</span></p><p data-lake-id=\"u742a17e2\" id=\"u742a17e2\" style=\"text-align: left\"><span data-lake-id=\"ub832f199\" id=\"ub832f199\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">注意两个点：</span></p><ul list=\"uc93c2278\"><li fid=\"u1fe26087\" data-lake-id=\"u9a6de24d\" id=\"u9a6de24d\" style=\"text-align: left\"><strong><span data-lake-id=\"u9a05d59b\" id=\"u9a05d59b\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">平均值是浮点数</span></strong><span data-lake-id=\"u66519379\" id=\"u66519379\" class=\"lake-fontsize-12\" style=\"color: rgb(1, 1, 1)\">（不是整除取整）</span></li><li fid=\"u1fe26087\" data-lake-id=\"uf3254321\" id=\"uf3254321\" style=\"text-align: left\"><strong><span data-lake-id=\"u3739a64e\" id=\"u3739a64e\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">返回结果要保持原数组顺序</span></strong></li></ul><p data-lake-id=\"u182bf840\" id=\"u182bf840\" style=\"text-align: left\"><span data-lake-id=\"ud9aa7b3d\" id=\"ud9aa7b3d\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">这个题用 JS 来做很顺手，核心就三步：</span></p><ol list=\"uf7998762\"><li fid=\"u35e22776\" data-lake-id=\"u735baee2\" id=\"u735baee2\" style=\"text-align: left\"><span data-lake-id=\"u258efd3d\" id=\"u258efd3d\" class=\"lake-fontsize-12\" style=\"color: rgb(1, 1, 1)\">先求均值</span></li><li fid=\"u35e22776\" data-lake-id=\"u1ef628d7\" id=\"u1ef628d7\" style=\"text-align: left\"><span data-lake-id=\"u97fe7444\" id=\"u97fe7444\" class=\"lake-fontsize-12\" style=\"color: rgb(1, 1, 1)\">遍历数组，找出比均值小的</span></li><li fid=\"u35e22776\" data-lake-id=\"ub6fd9c40\" id=\"ub6fd9c40\" style=\"text-align: left\"><span data-lake-id=\"uc89876d0\" id=\"uc89876d0\" class=\"lake-fontsize-12\" style=\"color: rgb(1, 1, 1)\">输出结果数组</span></li></ol><p data-lake-id=\"uf271b0ff\" id=\"uf271b0ff\" style=\"text-align: left\"><strong><span data-lake-id=\"uf4d76c29\" id=\"uf4d76c29\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">2）最朴素写法（for 循环）</span></strong></p><p data-lake-id=\"u990bafa3\" id=\"u990bafa3\" style=\"text-align: left\"><span data-lake-id=\"u8e3582a4\" id=\"u8e3582a4\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">我一开始写了个最直观的：</span></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22plain%22%2C%22code%22%3A%22function%20smallerThanAverage(arr)%20%7B%5Cn%20%20let%20sum%20%3D%200%3B%5Cn%20%20for%20(let%20i%20%3D%200%3B%20i%20%3C%20arr.length%3B%20i%2B%2B)%20%7B%5Cn%20%20%20%20sum%20%2B%3D%20arr%5Bi%5D%3B%5Cn%20%20%7D%5Cn%20%20const%20avg%20%3D%20sum%20%2F%20arr.length%3B%5Cn%5Cn%20%20let%20result%20%3D%20%5B%5D%3B%5Cn%20%20for%20(let%20i%20%3D%200%3B%20i%20%3C%20arr.length%3B%20i%2B%2B)%20%7B%5Cn%20%20%20%20if%20(arr%5Bi%5D%20%3C%20avg)%20%7B%5Cn%20%20%20%20%20%20result.push(arr%5Bi%5D)%3B%5Cn%20%20%20%20%7D%5Cn%20%20%7D%5Cn%20%20return%20result%3B%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22customStyle%22%3A%5B%5D%2C%22theme%22%3A%22default%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22o5AhF%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><p data-lake-id=\"u6ac65b98\" id=\"u6ac65b98\" style=\"text-align: left\"><span data-lake-id=\"u770c6bca\" id=\"u770c6bca\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">测试：</span></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22plain%22%2C%22code%22%3A%22console.log(smallerThanAverage(%5B1%2C%205%2C%203%2C%208%2C%202%5D))%3B%20%2F%2F%20%5B1%2C%203%2C%202%5D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22customStyle%22%3A%5B%5D%2C%22theme%22%3A%22default%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22Wlvu9%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><p data-lake-id=\"u97147516\" id=\"u97147516\" style=\"text-align: left\"><span data-lake-id=\"ub3f7813d\" id=\"ub3f7813d\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">——能跑，结果对，就是写法有点“老式”。</span></p><p data-lake-id=\"u52824e5e\" id=\"u52824e5e\" style=\"text-align: left\"><strong><span data-lake-id=\"uc2bda031\" id=\"uc2bda031\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">3）ES6 优化版（骚操作来了）</span></strong></p><p data-lake-id=\"udea61a33\" id=\"udea61a33\" style=\"text-align: left\"><span data-lake-id=\"uff8ce8f8\" id=\"uff8ce8f8\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">JS 有很多数组方法，写起来更简洁，尤其是 </span><code data-lake-id=\"u7b17d82e\" id=\"u7b17d82e\"><span data-lake-id=\"ua31b6236\" id=\"ua31b6236\" class=\"lake-fontsize-11\" style=\"color: rgb(30, 107, 184)\">reduce</span></code><span data-lake-id=\"uf3be5012\" id=\"uf3be5012\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\"> 和 </span><code data-lake-id=\"u994cb89a\" id=\"u994cb89a\"><span data-lake-id=\"u0503a3a6\" id=\"u0503a3a6\" class=\"lake-fontsize-11\" style=\"color: rgb(30, 107, 184)\">filter</span></code><span data-lake-id=\"u5a49c5bd\" id=\"u5a49c5bd\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">，可以写得优雅点：</span></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22plain%22%2C%22code%22%3A%22const%20smallerThanAverage%20%3D%20arr%20%3D%3E%20%7B%5Cn%20%20const%20avg%20%3D%20arr.reduce((sum%2C%20n)%20%3D%3E%20sum%20%2B%20n%2C%200)%20%2F%20arr.length%3B%5Cn%20%20return%20arr.filter(n%20%3D%3E%20n%20%3C%20avg)%3B%5Cn%7D%3B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22customStyle%22%3A%5B%5D%2C%22theme%22%3A%22default%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22n9ybJ%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><p data-lake-id=\"u996c2011\" id=\"u996c2011\" style=\"text-align: left\"><span data-lake-id=\"u37529fb4\" id=\"u37529fb4\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">这写法真的香！！！一行搞定求和，一行搞定过滤，性能也不差（底层都是循环）。</span></p><p data-lake-id=\"u292629ee\" id=\"u292629ee\" style=\"text-align: left\"><strong><span data-lake-id=\"ua4838c52\" id=\"ua4838c52\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">4）一些坑（别踩了）</span></strong></p><ul list=\"u79612810\"><li fid=\"u019de27c\" data-lake-id=\"u9285c05a\" id=\"u9285c05a\" style=\"text-align: left\"><strong><span data-lake-id=\"u0141b77a\" id=\"u0141b77a\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">空数组怎么办？</span></strong><span data-lake-id=\"uc3ccf79c\" id=\"uc3ccf79c\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">如果传空数组 </span><code data-lake-id=\"u86ccf5ae\" id=\"u86ccf5ae\"><span data-lake-id=\"u06a5959a\" id=\"u06a5959a\" class=\"lake-fontsize-11\" style=\"color: rgb(30, 107, 184)\">[]</span></code><span data-lake-id=\"u296498c4\" id=\"u296498c4\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">，会出现 </span><code data-lake-id=\"u0ff3be51\" id=\"u0ff3be51\"><span data-lake-id=\"u0dc630ed\" id=\"u0dc630ed\" class=\"lake-fontsize-11\" style=\"color: rgb(30, 107, 184)\">0/0=NaN</span></code><span data-lake-id=\"u5613f281\" id=\"u5613f281\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">，这时候 </span><code data-lake-id=\"ubf113d4b\" id=\"ubf113d4b\"><span data-lake-id=\"u3a0d5864\" id=\"u3a0d5864\" class=\"lake-fontsize-11\" style=\"color: rgb(30, 107, 184)\">filter</span></code><span data-lake-id=\"u3a49ce86\" id=\"u3a49ce86\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\"> 就全都 false。要不要抛错？我建议：</span></li></ul><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22plain%22%2C%22code%22%3A%22if%20(arr.length%20%3D%3D%3D%200)%20return%20%5B%5D%3B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22customStyle%22%3A%5B%5D%2C%22theme%22%3A%22default%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22evusb%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><ul list=\"udd8f1169\"><li fid=\"uab24284b\" data-lake-id=\"ub0aa344e\" id=\"ub0aa344e\" style=\"text-align: left\"><strong><span data-lake-id=\"u500307c7\" id=\"u500307c7\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">性能考虑</span></strong><span data-lake-id=\"u1a5cefcc\" id=\"u1a5cefcc\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">这个题对性能要求不高，O(n) 就够了。不过如果数组特别大（上百万数据），可以考虑：</span></li></ul><ul list=\"udd8f1169\" data-lake-indent=\"1\"><li fid=\"u6e527619\" data-lake-id=\"uc3289ed2\" id=\"uc3289ed2\" style=\"text-align: left\"><span data-lake-id=\"ue0e24962\" id=\"ue0e24962\" class=\"lake-fontsize-12\" style=\"color: rgb(1, 1, 1)\">一次遍历求和</span></li><li fid=\"u6e527619\" data-lake-id=\"u3b76dd14\" id=\"u3b76dd14\" style=\"text-align: left\"><span data-lake-id=\"u26a04c0e\" id=\"u26a04c0e\" class=\"lake-fontsize-12\" style=\"color: rgb(1, 1, 1)\">第二次遍历筛选（也就两次 O(n)，能接受）</span></li><li fid=\"u6e527619\" data-lake-id=\"u7b17219b\" id=\"u7b17219b\" style=\"text-align: left\"><span data-lake-id=\"u3934d267\" id=\"u3934d267\" class=\"lake-fontsize-12\" style=\"color: rgb(1, 1, 1)\">不要在 </span><code data-lake-id=\"uf582b7f6\" id=\"uf582b7f6\"><span data-lake-id=\"u543d7a5c\" id=\"u543d7a5c\" class=\"lake-fontsize-11\" style=\"color: rgb(30, 107, 184)\">filter</span></code><span data-lake-id=\"uc9748300\" id=\"uc9748300\" class=\"lake-fontsize-12\" style=\"color: rgb(1, 1, 1)\"> 里动态求平均值（别写成 </span><code data-lake-id=\"ud8662bb7\" id=\"ud8662bb7\"><span data-lake-id=\"u1dc9fb76\" id=\"u1dc9fb76\" class=\"lake-fontsize-11\" style=\"color: rgb(30, 107, 184)\">arr.filter(n =&gt; n &lt; arr.reduce(...))</span></code><span data-lake-id=\"u1e213024\" id=\"u1e213024\" class=\"lake-fontsize-12\" style=\"color: rgb(1, 1, 1)\">，会 O(n²) 爆炸）</span></li></ul><p data-lake-id=\"u832cad1d\" id=\"u832cad1d\" style=\"text-align: left\"><strong><span data-lake-id=\"ue07ad3d1\" id=\"ue07ad3d1\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">5）顺便玩个花活（链式写法）</span></strong></p><p data-lake-id=\"ue47cc074\" id=\"ue47cc074\" style=\"text-align: left\"><span data-lake-id=\"u68675818\" id=\"u68675818\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">我试了个骚操作，链式搞定：</span></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22plain%22%2C%22code%22%3A%22const%20smallerThanAverage%20%3D%20arr%20%3D%3E%20%5Cn%20%20arr.filter(n%20%3D%3E%20n%20%3C%20arr.reduce((s%2C%20x)%20%3D%3E%20s%20%2B%20x%2C%200)%20%2F%20arr.length)%3B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22customStyle%22%3A%5B%5D%2C%22theme%22%3A%22default%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22UEnTD%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><p data-lake-id=\"u1bfc420d\" id=\"u1bfc420d\" style=\"text-align: left\"><span data-lake-id=\"u3e4d0ba1\" id=\"u3e4d0ba1\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">虽然能跑，但性能会炸（因为 </span><code data-lake-id=\"ua2341627\" id=\"ua2341627\"><span data-lake-id=\"u70b8b2ce\" id=\"u70b8b2ce\" class=\"lake-fontsize-11\" style=\"color: rgb(30, 107, 184)\">reduce</span></code><span data-lake-id=\"u06675045\" id=\"u06675045\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\"> 在 </span><code data-lake-id=\"u4eecb771\" id=\"u4eecb771\"><span data-lake-id=\"u7628af3a\" id=\"u7628af3a\" class=\"lake-fontsize-11\" style=\"color: rgb(30, 107, 184)\">filter</span></code><span data-lake-id=\"u2fa05570\" id=\"u2fa05570\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\"> 里每次调用都会跑一遍），这就是典型的</span><strong><span data-lake-id=\"u23980f1c\" id=\"u23980f1c\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">写着酷炫但性能烂</span></strong><span data-lake-id=\"u200dd778\" id=\"u200dd778\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">的反例。</span></p><p data-lake-id=\"u6b678fd0\" id=\"u6b678fd0\" style=\"text-align: left\"><strong><span data-lake-id=\"u06fc69e0\" id=\"u06fc69e0\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">6）总结一下</span></strong></p><ul list=\"u51b93ccd\"><li fid=\"u8ca84ca5\" data-lake-id=\"uf945c76f\" id=\"uf945c76f\" style=\"text-align: left\"><span data-lake-id=\"u976e9711\" id=\"u976e9711\" class=\"lake-fontsize-12\" style=\"color: rgb(1, 1, 1)\">最推荐写法是 </span><strong><span data-lake-id=\"u7a6ea50c\" id=\"u7a6ea50c\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">reduce + filter</span></strong><span data-lake-id=\"u2395ab6d\" id=\"u2395ab6d\" class=\"lake-fontsize-12\" style=\"color: rgb(1, 1, 1)\">，简洁高效；</span></li><li fid=\"u8ca84ca5\" data-lake-id=\"u48d7dd34\" id=\"u48d7dd34\" style=\"text-align: left\"><span data-lake-id=\"u625b903c\" id=\"u625b903c\" class=\"lake-fontsize-12\" style=\"color: rgb(1, 1, 1)\">空数组要处理一下；</span></li><li fid=\"u8ca84ca5\" data-lake-id=\"u2a951d0d\" id=\"u2a951d0d\" style=\"text-align: left\"><span data-lake-id=\"u59cccbf0\" id=\"u59cccbf0\" class=\"lake-fontsize-12\" style=\"color: rgb(1, 1, 1)\">千万别把 </span><code data-lake-id=\"ub8217c66\" id=\"ub8217c66\"><span data-lake-id=\"u14a16374\" id=\"u14a16374\" class=\"lake-fontsize-11\" style=\"color: rgb(30, 107, 184)\">reduce</span></code><span data-lake-id=\"u2b1b3463\" id=\"u2b1b3463\" class=\"lake-fontsize-12\" style=\"color: rgb(1, 1, 1)\"> 放 </span><code data-lake-id=\"ufe0fb450\" id=\"ufe0fb450\"><span data-lake-id=\"u1f762c61\" id=\"u1f762c61\" class=\"lake-fontsize-11\" style=\"color: rgb(30, 107, 184)\">filter</span></code><span data-lake-id=\"u9342e0ab\" id=\"u9342e0ab\" class=\"lake-fontsize-12\" style=\"color: rgb(1, 1, 1)\"> 里算均值，那是真坑。</span></li></ul><p data-lake-id=\"uc583d9ef\" id=\"uc583d9ef\" style=\"text-align: left\"><span data-lake-id=\"uc5c52a52\" id=\"uc5c52a52\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">最终代码：</span></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22plain%22%2C%22code%22%3A%22function%20smallerThanAverage(arr)%20%7B%5Cn%20%20if%20(arr.length%20%3D%3D%3D%200)%20return%20%5B%5D%3B%5Cn%20%20const%20avg%20%3D%20arr.reduce((sum%2C%20n)%20%3D%3E%20sum%20%2B%20n%2C%200)%20%2F%20arr.length%3B%5Cn%20%20return%20arr.filter(n%20%3D%3E%20n%20%3C%20avg)%3B%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22customStyle%22%3A%5B%5D%2C%22theme%22%3A%22default%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22Hp2es%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><p data-lake-id=\"ubf6df162\" id=\"ubf6df162\" style=\"text-align: left\"><strong><span data-lake-id=\"ue634366c\" id=\"ue634366c\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">测试结果：</span></strong></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22search%22%3A%22%22%2C%22mode%22%3A%22plain%22%2C%22code%22%3A%22console.log(smallerThanAverage(%5B1%2C%205%2C%203%2C%208%2C%202%5D))%3B%20%2F%2F%20%5B1%2C%203%2C%202%5D%5Cnconsole.log(smallerThanAverage(%5B10%2C%2010%2C%2010%5D))%3B%20%20%20%2F%2F%20%5B%5D%5Cnconsole.log(smallerThanAverage(%5B%5D))%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%5B%5D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22customStyle%22%3A%5B%5D%2C%22theme%22%3A%22default%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22W0TRJ%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><p data-lake-id=\"u2ac7115b\" id=\"u2ac7115b\" style=\"text-align: left\"><span data-lake-id=\"u420c96c8\" id=\"u420c96c8\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">性能稳定，写法优雅，封神了！！！</span></p><p data-lake-id=\"ub898c412\" id=\"ub898c412\" style=\"text-align: left\"><span data-lake-id=\"u2f8ea70c\" id=\"u2f8ea70c\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">你想让我再</span><strong><span data-lake-id=\"u0b0bf95c\" id=\"u0b0bf95c\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">写个 LeetCode 风格的完整题解（带测试用例）</span></strong><span data-lake-id=\"uf3ec71ec\" id=\"uf3ec71ec\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">，还是要</span><strong><span data-lake-id=\"u14545f18\" id=\"u14545f18\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">扩展成更复杂的版本</span></strong><span data-lake-id=\"u1d5c2c4e\" id=\"u1d5c2c4e\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">（比如二维数组、带对象的数组）？</span></p><p data-lake-id=\"u345c3ce3\" id=\"u345c3ce3\" style=\"text-align: center\"><strong><span data-lake-id=\"uff5248ad\" id=\"uff5248ad\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">-END</span></strong><strong><span data-lake-id=\"u5ac64bd4\" id=\"u5ac64bd4\" class=\"lake-fontsize-12\" style=\"color: rgb(0, 0, 0)\">-</span></strong></p><p data-lake-id=\"ucb1fa733\" id=\"ucb1fa733\"><span data-lake-id=\"u6be997b4\" id=\"u6be997b4\">  </span></p>");
				state.loading = false;
			});
	});
</script>

<style scoped lang="scss">
	@use 'articleReader';
</style>
